package com.symphony.malware.scan.metrics;

import com.symphony.metrics.reporter.SymphonyCloudReporter;

import com.codahale.metrics.MetricRegistry;

import java.util.concurrent.TimeUnit;

/**
 * Reports Malware Scanning metrics.
 *
 * @author Andrey Zavizionov on 2020-01-28
 */
public class MetricReport {
  private static final int REPORT_PERIOD = 1;
  private static final String PRINCIPAL = "MALWARE-SCANNING";
  private static final String PRINCIPAL_VERSION = "1.0";
  private final MetricRegistry registry;
  private SymphonyCloudReporter reporter;

  /**
   * @param instanceId instance ID associated with reported metrics
   */
  public MetricReport(String instanceId) {
    this.registry = new MetricRegistry();
    startReport(instanceId);
  }

  void startReport(String instanceId) {
    reporter = SymphonyCloudReporter
        .forRegistry(registry, PRINCIPAL, PRINCIPAL_VERSION)
        .withInstanceId(instanceId)
        .build();
    reporter.start(REPORT_PERIOD, TimeUnit.MINUTES);
  }

  public MetricRegistry getRegistry() {
    return registry;
  }

  SymphonyCloudReporter getReporter() {
    return reporter;
  }
}
