package com.symphony.malware.scan.workflow;

import com.symphony.malware.scan.model.MalwareScanRequestDto;
import com.symphony.malware.scan.persistence.exception.MalwareScanException;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

class InitialSubmissionAttemptWorkflow {
    private static final Logger LOGGER = LoggerFactory.getLogger(InitialSubmissionAttemptWorkflow.class);
    private final MalwareScanSubmissionWorkflowHelper malwareScanSubmissionWorkflowHelper;

    InitialSubmissionAttemptWorkflow(MalwareScanSubmissionWorkflowHelper malwareScanSubmissionWorkflowHelper) {
        this.malwareScanSubmissionWorkflowHelper = malwareScanSubmissionWorkflowHelper;
    }

    /**
     * Submits a request for scanning. This is the initial submission request. The method will throw
     * if the request has already been submitted for scanning.
     * @param malwareScanRequestDto
     * @throws MalwareScanException
     */
    void processRequest(final MalwareScanRequestDto malwareScanRequestDto) throws MalwareScanException {
        LOGGER.info("Submitting fileId {} with messageId {}",
                malwareScanRequestDto.getAttachmentMetaDto().getFileId(), malwareScanRequestDto.getMessageId());

        malwareScanSubmissionWorkflowHelper.scan(malwareScanRequestDto);
    }
}
