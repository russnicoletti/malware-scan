package com.symphony.malware.scan.model;

import com.fasterxml.jackson.databind.annotation.JsonDeserialize;
import com.fasterxml.jackson.databind.annotation.JsonPOJOBuilder;
import lombok.Builder;
import lombok.Getter;
import lombok.ToString;

import java.io.Serializable;

/**
 * Malware scan file state object, which is stored to the database
 * Represents a malware scan state of the file
 */
@Getter
@Builder(toBuilder = true)
@JsonDeserialize(builder = MalwareScanFileState.MalwareScanFileStateBuilder.class)
@ToString(of = {"fileId", "version", "createTimestamp", "originalStreamId", "originalMessageId", "status"})
public class MalwareScanFileState implements Serializable {

    private String fileId;

    @Builder.Default
    private long version = 0L;

    private Status status;

    private Long ttl;

    private Long createTimestamp;

    /**
     * The {@link Actor} who created the entry
     */
    private Actor createdBy;

    private Long lastUpdateTimestamp;

    /**
     * The {@link Actor} who updated the entry last
     */
    private Actor lastUpdatedBy;

    private Long lastSubmissionAttemptTimestamp;

    private String contentType;

    private String originalStreamId;

    private String originalMessageId;

    /**
     * Details provided by Malware Scanner
     */
    private MalwareScanFileStatusDetails details;

    private Long numberOfRetries;


    @JsonPOJOBuilder(withPrefix = "")
    public static final class MalwareScanFileStateBuilder {}


    /**
     * Status of malware scan
     */
    public enum Status {
        PENDING, SUBMITTED, SCAN_ERROR, OK, BAD, UNSCANNABLE, EXPIRED, FAILED_SUBMIT, FAILED_UPDATE
    }
}
